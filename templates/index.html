<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini ATS Analyzer | Premium Career Insights</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #fdfdfd; color: #1e293b; }
        .hero-gradient { background: radial-gradient(circle at top right, #eff6ff 0%, #ffffff 100%); }
        .card-shadow { box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05); }
        .drop-zone--over { border-color: #2563eb; background-color: #f8faff; transform: scale(1.01); }
        .shimmer { 
            background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%); 
            background-size: 200% 100%; 
            animation: shimmer 1.5s infinite linear; 
        }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen hero-gradient">

    <!-- Navigation / Header -->
    <nav class="sticky top-0 z-40 w-full bg-white/80 backdrop-blur-md border-b border-slate-100">
        <div class="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-blue-200">
                    <i class="fas fa-bolt"></i>
                </div>
                <span class="text-xl font-extrabold tracking-tight">Gemini<span class="text-blue-600">ATS</span></span>
            </div>
            <div class="hidden md:flex items-center gap-8 text-sm font-semibold text-slate-500">
                <a href="#" class="hover:text-blue-600 transition-colors">How it works</a>
                <a href="#" class="hover:text-blue-600 transition-colors">Privacy</a>
                <button onclick="location.reload()" class="px-5 py-2.5 bg-slate-100 hover:bg-slate-200 rounded-lg transition-all text-slate-900">Reset Analysis</button>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-6 py-10">
        
        <!-- Welcome Section -->
        <div id="welcomeSection" class="max-w-3xl mx-auto text-center mb-16 transition-all duration-500">
            <h2 class="text-4xl md:text-5xl font-extrabold text-slate-900 mb-6 leading-tight">Land your dream job with AI-powered resume analysis.</h2>
            <p class="text-lg text-slate-500 mb-10">Upload your resume and get instant feedback on how well it matches job descriptions, identifies missing keywords, and optimizes for ATS filters.</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">
            
            <!-- Left Panel: The Input Terminal -->
            <div class="lg:col-span-4 space-y-6">
                <div class="bg-white rounded-3xl p-8 border border-slate-100 card-shadow sticky top-28">
                    <form id="resumeForm" enctype="multipart/form-data" class="space-y-8">
                        <div>
                            <label class="block text-sm font-bold text-slate-700 mb-4 flex items-center gap-2">
                                <span class="w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs">1</span>
                                Upload Resume
                            </label>
                            <div id="dropZone" class="group relative border-2 border-dashed border-slate-200 rounded-2xl p-8 transition-all hover:border-blue-400 text-center bg-slate-50/50">
                                <input type="file" id="resumeFile" name="file" accept=".pdf" class="absolute inset-0 opacity-0 cursor-pointer" required>
                                <div id="filePreview" class="space-y-3">
                                    <div class="w-14 h-14 bg-white rounded-2xl shadow-sm mx-auto flex items-center justify-center text-slate-400 group-hover:text-blue-500 transition-colors">
                                        <i class="fas fa-file-upload text-2xl"></i>
                                    </div>
                                    <p class="text-sm font-medium text-slate-600">Click to upload or drag & drop</p>
                                    <p class="text-xs text-slate-400">PDF files only (Max 10MB)</p>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-bold text-slate-700 mb-4 flex items-center gap-2">
                                <span class="w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs">2</span>
                                Target Job Description
                            </label>
                            <textarea id="jdInput" name="job_description" placeholder="Paste the job requirements here..." 
                                      class="w-full text-sm border border-slate-200 rounded-2xl p-5 h-48 focus:ring-4 focus:ring-blue-500/5 focus:border-blue-500 outline-none transition-all resize-none bg-slate-50/50"></textarea>
                        </div>

                        <button type="submit" id="submitBtn" class="w-full py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-2xl font-bold shadow-xl shadow-blue-200 transition-all active:scale-[0.98] flex items-center justify-center gap-3">
                            <span>Analyze Profile</span>
                            <i class="fas fa-arrow-right text-sm"></i>
                        </button>
                    </form>
                </div>
            </div>

            <!-- Right Panel: Dynamic Content View -->
            <div class="lg:col-span-8">
                
                <!-- Initial Empty State -->
                <div id="emptyState" class="bg-white rounded-3xl p-16 border border-dashed border-slate-200 text-center">
                    <div class="w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-chart-line text-3xl text-slate-300"></i>
                    </div>
                    <h3 class="text-xl font-bold text-slate-800 mb-2">Ready for analysis</h3>
                    <p class="text-slate-500 max-w-sm mx-auto">Once you upload your details, we'll display your parsed profile and ATS score here.</p>
                </div>

                <!-- Loading State -->
                <div id="loading" class="hidden space-y-6">
                    <div class="bg-white p-10 rounded-3xl border border-slate-100 shadow-sm">
                        <div class="flex items-center gap-6 mb-8">
                            <div class="w-20 h-20 rounded-2xl shimmer"></div>
                            <div class="flex-1 space-y-3">
                                <div class="h-6 w-1/3 shimmer rounded-lg"></div>
                                <div class="h-4 w-1/2 shimmer rounded-lg"></div>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div class="h-4 w-full shimmer rounded-lg"></div>
                            <div class="h-4 w-full shimmer rounded-lg"></div>
                            <div class="h-4 w-3/4 shimmer rounded-lg"></div>
                        </div>
                    </div>
                    <div class="text-center py-4">
                        <div class="inline-flex items-center gap-3 px-4 py-2 bg-blue-50 text-blue-600 rounded-full text-sm font-bold animate-pulse">
                             <i class="fas fa-sync fa-spin"></i>
                             Gemini AI is generating deep insights...
                        </div>
                    </div>
                </div>

                <!-- Result View -->
                <div id="result" class="hidden space-y-8">
                    
                    <!-- Stats Bar -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm">
                            <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">ATS Score</p>
                            <div class="flex items-baseline gap-2">
                                <span id="scoreVal" class="text-4xl font-black text-blue-600">--</span>
                                <span class="text-slate-400 font-bold">/ 100</span>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm md:col-span-2 flex items-center justify-between">
                            <div>
                                <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Analysis Status</p>
                                <p class="text-sm font-bold text-emerald-600"><i class="fas fa-check-circle mr-1"></i> Analysis Complete</p>
                            </div>
                            <p class="text-xs text-slate-400 italic" id="resultTimestamp"></p>
                        </div>
                    </div>

                    <!-- Main Content Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        
                        <!-- Column 1: Profile & Resume Breakdown -->
                        <div class="space-y-6">
                            <div class="flex items-center justify-between px-1">
                                <h4 class="text-sm font-extrabold text-slate-900 flex items-center gap-2">
                                    <i class="fas fa-id-card text-blue-500"></i>
                                    RESUME BREAKDOWN
                                </h4>
                            </div>
                            <div id="resumeProfileView" class="bg-white rounded-3xl p-8 border border-slate-100 shadow-sm space-y-8">
                                <!-- AI parsed Resume, Skills, Experience, Education goes here -->
                                <div class="text-slate-400 text-sm italic">Parsing document sections...</div>
                            </div>
                        </div>

                        <!-- Column 2: Intelligence & Optimization -->
                        <div class="space-y-6">
                            <h4 class="text-sm font-extrabold text-slate-900 flex items-center gap-2 px-1">
                                <i class="fas fa-brain text-purple-500"></i>
                                OPTIMIZATION TIPS
                            </h4>
                            <div id="atsFeedbackView" class="space-y-4">
                                <!-- Pros, Cons, Recommendations, Issues go here -->
                                <div class="text-slate-400 text-sm italic">Analyzing matching keywords...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Error Modal -->
    <div id="errorModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm">
        <div class="bg-white rounded-3xl p-8 max-w-md w-full shadow-2xl">
            <div class="w-16 h-16 bg-red-50 text-red-500 rounded-2xl flex items-center justify-center mb-6 text-2xl">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h3 class="text-xl font-bold text-slate-900 mb-2">Analysis Failed</h3>
            <p id="errorMessage" class="text-slate-500 mb-8 leading-relaxed"></p>
            <button onclick="closeError()" class="w-full py-4 bg-slate-900 text-white rounded-2xl font-bold">Try Again</button>
        </div>
    </div>

<script>
const form = document.getElementById('resumeForm');
const fileInput = document.getElementById('resumeFile');
const dropZone = document.getElementById('dropZone');
const filePreview = document.getElementById('filePreview');
const resultDiv = document.getElementById('result');
const loader = document.getElementById('loading');
const emptyState = document.getElementById('emptyState');
const welcomeSection = document.getElementById('welcomeSection');
const submitBtn = document.getElementById('submitBtn');

const showError = (msg) => {
    document.getElementById('errorMessage').textContent = msg;
    document.getElementById('errorModal').classList.remove('hidden');
}
const closeError = () => document.getElementById('errorModal').classList.add('hidden');

fileInput.addEventListener('change', () => {
    if (fileInput.files.length) {
        filePreview.innerHTML = `
            <div class="w-14 h-14 bg-red-50 rounded-2xl shadow-sm mx-auto flex items-center justify-center text-red-500">
                <i class="fas fa-file-pdf text-2xl"></i>
            </div>
            <p class="text-sm font-bold text-slate-800">${fileInput.files[0].name}</p>
            <p class="text-xs text-blue-600 font-bold uppercase tracking-widest">File Ready</p>
        `;
        dropZone.classList.add('border-blue-400', 'bg-blue-50/50');
    }
});

['dragover', 'dragleave', 'drop'].forEach(evt => {
    dropZone.addEventListener(evt, e => {
        e.preventDefault();
        if (evt === 'dragover') dropZone.classList.add('drop-zone--over');
        else dropZone.classList.remove('drop-zone--over');
    });
});

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    if (!fileInput.files.length) return;

    submitBtn.disabled = true;
    submitBtn.innerHTML = `<i class="fas fa-circle-notch fa-spin"></i> Analyzing...`;
    
    welcomeSection.classList.add('opacity-0', 'pointer-events-none');
    emptyState.classList.add('hidden');
    loader.classList.remove('hidden');
    resultDiv.classList.add('hidden');

    const formData = new FormData(form);

    try {
        const response = await fetch('/analyze', {
            method: 'POST',
            body: formData
        });

        const data = await response.json();

        if (response.ok) {
            renderFullWebsiteView(data.result);
            resultDiv.classList.remove('hidden');
            document.getElementById('resultTimestamp').textContent = `Processed at ${new Date().toLocaleTimeString()}`;
            window.scrollTo({ top: 100, behavior: 'smooth' });
        } else {
            showError(data.error || "Failed to process resume.");
            emptyState.classList.remove('hidden');
        }
    } catch (err) {
        showError("Connectivity error. Is the server running?");
        emptyState.classList.remove('hidden');
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = `<span>Analyze Profile</span><i class="fas fa-arrow-right text-sm"></i>`;
        loader.classList.add('hidden');
    }
});

function renderFullWebsiteView(rawText) {
    const profileView = document.getElementById('resumeProfileView');
    const feedbackView = document.getElementById('atsFeedbackView');
    
    profileView.innerHTML = '';
    feedbackView.innerHTML = '';
    
    // Extract Score
    const scoreMatch = rawText.match(/SCORE:\s*(\d+)/i);
    document.getElementById('scoreVal').textContent = scoreMatch ? scoreMatch[1] : '--';

    // Parse Sections
    const sections = rawText.split(/\n(?=[A-Z_]+:)/);
    
    sections.forEach(section => {
        const match = section.match(/^([A-Z_]+):/);
        if (!match) return;
        
        const titleKey = match[1];
        const titleDisplay = titleKey.replace(/_/g, ' ');
        const rawContent = section.replace(/^([A-Z_]+):/, '').trim();
        
        if (titleKey === "SCORE") return;

        // Categorize Sections
        const isProfileData = ["RESUME", "SKILLS", "EXPERIENCE", "EDUCATION"].includes(titleKey);
        
        const wrapper = document.createElement('div');
        
        // Formatter for bullets and badges
        let htmlBody = '';
        const items = rawContent.split(/\n- /).map(i => i.replace(/^-/, '').trim()).filter(i => i);
        
        if (items.length > 0 && (titleKey.includes("SKILLS") || titleKey.includes("KEYWORDS"))) {
            // Render as Badges
            htmlBody = `<div class="flex flex-wrap gap-2 mt-3">` + 
                items.map(item => `<span class="px-3 py-1 bg-slate-100 text-slate-700 rounded-full text-[10px] font-extrabold uppercase tracking-tight border border-slate-200">${item}</span>`).join('') + 
                `</div>`;
        } else if (items.length > 0) {
            // Render as List
            htmlBody = `<ul class="space-y-3 mt-3">` + 
                items.map(item => `
                    <li class="flex gap-3 text-sm text-slate-600 leading-relaxed">
                        <span class="mt-1.5 w-1.5 h-1.5 rounded-full bg-blue-500/40 shrink-0"></span>
                        <span>${item}</span>
                    </li>`).join('') + 
                `</ul>`;
        } else {
            // Render as Paragraph
            htmlBody = `<p class="mt-3 text-sm text-slate-600 leading-relaxed whitespace-pre-wrap">${rawContent}</p>`;
        }

        if (isProfileData) {
            wrapper.className = "pb-8 border-b border-slate-50 last:border-0";
            wrapper.innerHTML = `
                <h5 class="text-[10px] font-black text-blue-500 uppercase tracking-widest">${titleDisplay}</h5>
                ${htmlBody}
            `;
            profileView.appendChild(wrapper);
        } else {
            wrapper.className = "bg-white p-6 rounded-2xl border border-slate-100 shadow-sm transition-all hover:border-slate-200";
            
            let color = "text-slate-400";
            let icon = "fa-info-circle";
            
            if (titleKey === "PROS") { color = "text-emerald-500"; icon = "fa-check-double"; }
            else if (titleKey === "CONS" || titleKey === "CRITICAL_ISSUES") { color = "text-rose-500"; icon = "fa-exclamation-circle"; }
            else if (titleKey === "RECOMMENDATIONS") { color = "text-indigo-600"; icon = "fa-lightbulb"; }
            else if (titleKey === "MISSING_SKILLS" || titleKey === "MISSING_KEYWORDS") { color = "text-amber-500"; icon = "fa-search-plus"; }
            else if (titleKey === "MATCHED_SKILLS") { color = "text-blue-500"; icon = "fa-link"; }

            wrapper.innerHTML = `
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-lg bg-slate-50 flex items-center justify-center ${color}">
                        <i class="fas ${icon} text-sm"></i>
                    </div>
                    <h5 class="text-xs font-black text-slate-800 uppercase tracking-widest">${titleDisplay}</h5>
                </div>
                <div class="ml-11">${htmlBody}</div>
            `;
            feedbackView.appendChild(wrapper);
        }
    });

    // Cleanup empty profile side
    if (profileView.children.length === 0) {
        profileView.innerHTML = `<div class="text-center py-10 text-slate-400 text-sm"><i class="fas fa-ghost block mb-2 text-2xl"></i>No profile data parsed.</div>`;
    }
}
</script>

</body>
</html>